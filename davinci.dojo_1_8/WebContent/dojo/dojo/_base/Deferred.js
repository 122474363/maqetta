/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

//>>built
define("dojo/_base/Deferred",["./kernel","./config","./lang","../promise/Promise","../when"],function(_1,_2,_3,_4,_5){var _6=function(){};var _7=Object.freeze||function(){};var _8=_1.Deferred=function(_9){var _a,_b,_c,_d,_e;var _f=(this.promise=new _4);function _10(_11){if(_b){throw new Error("This deferred has already been resolved");}_a=_11;_b=true;_12();};function _12(){var _13;while(!_13&&_e){var _14=_e;_e=_e.next;if((_13=(_14.progress==_6))){_b=false;}var _15=(_c?_14.error:_14.resolved);if(_15){try{var _16=_15(_a);if(_16&&typeof _16.then==="function"){_16.then(_3.hitch(_14.deferred,"resolve"),_3.hitch(_14.deferred,"reject"),_3.hitch(_14.deferred,"progress"));continue;}var _17=_13&&_16===undefined;if(_13&&!_17){_c=_16 instanceof Error;}_14.deferred[_17&&_c?"reject":"resolve"](_17?_a:_16);}catch(e){_14.deferred.reject(e);}}else{if(_c){_14.deferred.reject(_a);}else{_14.deferred.resolve(_a);}}}};this.resolve=this.callback=function(_18){this.fired=0;this.results=[_18,null];_10(_18);};this.reject=this.errback=function(_19){_c=true;this.fired=1;_10(_19);this.results=[null,_19];};this.progress=function(_1a){var _1b=_e;while(_1b){var _1c=_1b.progress;_1c&&_1c(_1a);_1b=_1b.next;}};this.addCallbacks=function(_1d,_1e){this.then(_1d,_1e,_6);return this;};_f.then=this.then=function(_1f,_20,_21){var _22=_21==_6?this:new _8(_f.cancel);var _23={resolved:_1f,error:_20,progress:_21,deferred:_22};if(_e){_d=_d.next=_23;}else{_e=_d=_23;}if(_b){_12();}return _22.promise;};var _24=this;_f.cancel=this.cancel=function(){if(!_b){var _25=_9&&_9(_24);if(!_b){if(!(_25 instanceof Error)){_25=new Error(_25);}_25.log=false;_24.reject(_25);}}};_7(_f);};_3.extend(_8,{addCallback:function(_26){return this.addCallbacks(_3.hitch.apply(_1,arguments));},addErrback:function(_27){return this.addCallbacks(null,_3.hitch.apply(_1,arguments));},addBoth:function(_28){var _29=_3.hitch.apply(_1,arguments);return this.addCallbacks(_29,_29);},fired:-1});_8.when=_1.when=_5;return _8;});