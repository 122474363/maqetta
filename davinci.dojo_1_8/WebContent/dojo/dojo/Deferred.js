/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

//>>built
define("dojo/Deferred",["./_base/lang","./promise/CancelError","./promise/Promise"],function(_1,_2,_3){"use strict";var _4=0,_5=1,_6=2;var _7="This deferred has already been fulfilled.";var _8=function(){};var _9=Object.freeze||_8;var _a=function(_b,_c,_d){for(var i=0;i<_b.length;i++){_e(_b[i],_c,_d);}};var _e=function(_f,_10,_11){var _12=_f[_10];var _13=_f.deferred;if(_12){try{var _14=_12(_11);if(_14&&typeof _14.then==="function"){_f.cancel=_14.cancel;_14.then(_15(_13,_5),_15(_13,_6),_15(_13,_4));return;}_16(_13,_5,_14);}catch(error){_16(_13,_6,error);}}else{_16(_13,_10,_11);}};var _15=function(_17,_18){return function(_19){_16(_17,_18,_19);};};var _16=function(_1a,_1b,_1c){if(!_1a.isCanceled()){switch(_1b){case _4:_1a.progress(_1c);break;case _5:_1a.resolve(_1c);break;case _6:_1a.reject(_1c);break;}}};var _1d=_1.extend(function(_1e){var _1f=this.promise=new _3();var _20,_21;var _22=false;var _23=[];this.isResolved=_1f.isResolved=function(){return _20===_5;};this.isRejected=_1f.isRejected=function(){return _20===_6;};this.isFulfilled=_1f.isFulfilled=function(){return !!_20;};this.isCanceled=_1f.isCanceled=function(){return _22;};this.progress=function(_24,_25){if(!_20){_a(_23,_4,_24);return _1f;}else{if(_25===true){throw new Error(_7);}else{return _1f;}}};this.resolve=function(_26,_27){if(!_20){_a(_23,_20=_5,_21=_26);_23=null;return _1f;}else{if(_27===true){throw new Error(_7);}else{return _1f;}}};this.reject=function(_28,_29){if(!_20){_a(_23,_20=_6,_21=_28);_23=null;return _1f;}else{if(_29===true){throw new Error(_7);}else{return _1f;}}};this.then=_1f.then=function(_2a,_2b,_2c){var _2d=[_2c,_2a,_2b];_2d.cancel=_1f.cancel;_2d.deferred=new _1d(function(_2e){return _2d.cancel&&_2d.cancel(_2e);});if(_20&&!_23){_e(_2d,_20,_21);}else{_23.push(_2d);}return _2d.deferred.promise;};this.cancel=_1f.cancel=function(_2f,_30){if(!_20){if(_1e){var _31=_1e(_2f);_2f=typeof _31==="undefined"?_2f:_31;}_22=true;if(!_20){if(typeof _2f==="undefined"){_2f=new _2();}_a(_23,_20=_6,_21=_2f);_23=null;return _2f;}else{if(_20===_6&&_21===_2f){return _2f;}}}else{if(_30===true){throw new Error(_7);}}};_9(_1f);},{promise:null,resolve:_8,reject:_8,progress:_8,then:_8,cancel:_8,isResolved:_8,isRejected:_8,isFulfilled:_8,isCanceled:_8});return _1d;});