//>>built
define("dojox/app/main",["dojo/_base/lang","dojo/_base/declare","dojo/Deferred","dojo/when","require","dojo/has","dojo/_base/config","dojo/on","dojo/ready","dojo/_base/window","dojo/dom-construct","./model","./View","./controllers/Load","./controllers/Transition","./controllers/Layout","dojo/_base/loader","dojo/store/Memory"],function(_1,_2,_3,_4,_5,_6,_7,on,_8,_9,_a,_b,_c,_d,_e,_f){dojo.experimental("dojox.app");_6.add("app-log-api",(_7["app"]||{}).debugApp);var _10=_2(null,{constructor:function(_11,_12){_1.mixin(this,_11);this.params=_11;this.id=_11.id;this.defaultView=_11.defaultView;this.widgetId=_11.id;this.controllers=[];this.children={};this.loadedModels={};this.domNode=_a.create("div",{id:this.id+"_Root",style:"width:100%; height:100%; overflow-y:hidden; overflow-x:hidden;"});_12.appendChild(this.domNode);},createDataStore:function(_13){if(_13.stores){for(var _14 in _13.stores){if(_14.charAt(0)!=="_"){var _15=_13.stores[_14].type?_13.stores[_14].type:"dojo.store.Memory";var _16={};if(_13.stores[_14].params){_1.mixin(_16,_13.stores[_14].params);}var _17=_1.getObject(_15);if(_16.data&&_1.isString(_16.data)){_16.data=_1.getObject(_16.data);}_13.stores[_14].store=new _17(_16);}}}},createControllers:function(_18){if(_18){var _19=[];for(var i=0;i<_18.length;i++){_19.push(_18[i]);}var def=new _3();var _1a;try{_1a=_5.on("error",function(_1b){if(def.isResolved()||def.isRejected()){return;}def.reject("load controllers error.");_1a.remove();});_5(_19,function(){def.resolve.call(def,arguments);_1a.remove();});}catch(ex){def.reject("load controllers error.");_1a.remove();}var _1c=new _3();_4(def,_1.hitch(this,function(){for(var i=0;i<arguments[0].length;i++){this.controllers.push(new arguments[0][i](this));}_1c.resolve(this);}),function(){_1c.reject("load controllers error.");});return _1c;}},trigger:function(_1d,_1e){on.emit(this.domNode,_1d,_1e);},start:function(){this.createDataStore(this.params);var _1f=new _3();var _20;try{_20=_b(this.params.models,this);}catch(ex){_1f.reject("load model error.");return _1f.promise;}if(_20.then){_4(_20,_1.hitch(this,function(_21){this.loadedModels=_21;this.setupAppView();}),function(){_1f.reject("load model error.");});}else{this.loadedModels=_20;this.setupAppView();}},setupAppView:function(){if(this.template){this.view=new _c({app:this,name:this.name,parent:this,templateString:this.templateString,definition:this.definition});_4(this.view.start(),_1.hitch(this,function(){this.domNode=this.view.domNode;this.setupControllers();this.startup();}));}else{this.setupControllers();this.startup();}},setupControllers:function(){new _d(this);new _e(this);new _f(this);var _22=window.location.hash;this._startView=((_22&&_22.charAt(0)=="#")?_22.substr(1):_22)||this.defaultView;},startup:function(){var _23=this.createControllers(this.params.controllers);_4(_23,_1.hitch(this,function(_24){this.trigger("load",{"viewId":this.defaultView,"callback":_1.hitch(this,function(){var _25=this.defaultView.split(",");_25=_25.shift();this.selectedChild=this.children[this.id+"_"+_25];this.trigger("transition",{"viewId":this._startView});this.setStatus(this.lifecycle.STARTED);})});}));}});function _26(_27,_28,_29,_2a){var _2b=window.location.pathname;if(_2b.charAt(_2b.length)!="/"){_2b=_2b.split("/");_2b.pop();_2b=_2b.join("/");}dojo.registerModulePath("app",_2b);if(!_27.modules){_27.modules=[];}_27.modules.push("dojox/app/module/lifecycle");var _2c=_27.modules.concat(_27.dependencies);if(_27.template){_2c.push("dojo/text!"+"app/"+_27.template);}_5(_2c,function(){var _2d=[_10];for(var i=0;i<_27.modules.length;i++){_2d.push(arguments[i]);}if(_27.template){var ext={templateString:arguments[arguments.length-1]};}App=_2(_2d,ext);_8(function(){var app=App(_27,_28||_9.body());if(_6("app-log-api")){app.log=function(){var msg="";try{for(var i=0;i<arguments.length-1;i++){msg=msg+arguments[i];}}catch(e){}};}else{app.log=function(){};}app.setStatus(app.lifecycle.STARTING);app.start();var _2e=app.id;if(window[_2e]){_1.mixin(app,window[_2e]);}window[_2e]=app;});});};return function(_2f,_30){if(!_2f){throw Error("App Config Missing");}if(_2f.validate){_5(["dojox/json/schema","dojox/json/ref","dojo/text!dojox/application/schema/application.json"],function(_31,_32){_31=dojox.json.ref.resolveJson(_31);if(_31.validate(_2f,_32)){_26(_2f,_30);}});}else{_26(_2f,_30);}};});