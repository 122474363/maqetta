//>>built
define("dojox/charting/Chart",["../main","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/dom-style","dojo/dom","dojo/dom-geometry","dojo/dom-construct","dojo/_base/Color","dojo/_base/sniff","./Element","./SimpleTheme","./Series","./axis2d/common","dojox/gfx","dojox/lang/functional","dojox/lang/functional/fold","dojox/lang/functional/reversed"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,g,_f,_10,_11){var dc=_2.getObject("charting",true,_1),_12=_f.lambda("item.clear()"),_13=_f.lambda("item.purgeGroup()"),_14=_f.lambda("item.destroy()"),_15=_f.lambda("item.dirty = false"),_16=_f.lambda("item.dirty = true"),_17=_f.lambda("item.name");_4("dojox.charting.Chart",null,{constructor:function(_18,_19){if(!_19){_19={};}this.margins=_19.margins?_19.margins:{l:10,t:10,r:10,b:10};this.stroke=_19.stroke;this.fill=_19.fill;this.delayInMs=_19.delayInMs||200;this.title=_19.title;this.titleGap=_19.titleGap;this.titlePos=_19.titlePos;this.titleFont=_19.titleFont;this.titleFontColor=_19.titleFontColor;this.chartTitle=null;this.theme=null;this.axes={};this.stack=[];this.plots={};this.series=[];this.runs={};this.dirty=true;this.node=_6.byId(_18);var box=_7.getMarginBox(_18);this.surface=g.createSurface(this.node,box.w||400,box.h||300);if(this.surface.declaredClass.indexOf("vml")==-1){this.plotGroup=this.surface.createGroup();}},destroy:function(){_3.forEach(this.series,_14);_3.forEach(this.stack,_14);_f.forIn(this.axes,_14);if(this.chartTitle&&this.chartTitle.tagName){_8.destroy(this.chartTitle);}if(this.plotGroup){this.plotGroup.destroy();}this.surface.destroy();},getCoords:function(){var _1a=this.node;var s=_5.getComputedStyle(_1a),_1b=_7.getMarginBox(_1a,s);var abs=_7.position(_1a,true);_1b.x=abs.x;_1b.y=abs.y;return _1b;},setTheme:function(_1c){this.theme=_1c.clone();this.dirty=true;return this;},addAxis:function(_1d,_1e){var _1f,_20=_1e&&_1e.type||"Default";if(typeof _20=="string"){if(!dc.axis2d||!dc.axis2d[_20]){throw Error("Can't find axis: "+_20+" - Check "+"require() dependencies.");}_1f=new dc.axis2d[_20](this,_1e);}else{_1f=new _20(this,_1e);}_1f.name=_1d;_1f.dirty=true;if(_1d in this.axes){this.axes[_1d].destroy();}this.axes[_1d]=_1f;this.dirty=true;return this;},getAxis:function(_21){return this.axes[_21];},removeAxis:function(_22){if(_22 in this.axes){this.axes[_22].destroy();delete this.axes[_22];this.dirty=true;}return this;},addPlot:function(_23,_24){var _25,_26=_24&&_24.type||"Default";if(typeof _26=="string"){if(!dc.plot2d||!dc.plot2d[_26]){throw Error("Can't find plot: "+_26+" - didn't you forget to dojo"+".require() it?");}_25=new dc.plot2d[_26](this,_24);}else{_25=new _26(this,_24);}_25.name=_23;_25.dirty=true;if(_23 in this.plots){this.stack[this.plots[_23]].destroy();this.stack[this.plots[_23]]=_25;}else{this.plots[_23]=this.stack.length;this.stack.push(_25);}this.dirty=true;return this;},getPlot:function(_27){return this.stack[this.plots[_27]];},removePlot:function(_28){if(_28 in this.plots){var _29=this.plots[_28];delete this.plots[_28];this.stack[_29].destroy();this.stack.splice(_29,1);_f.forIn(this.plots,function(idx,_2a,_2b){if(idx>_29){_2b[_2a]=idx-1;}});var ns=_3.filter(this.series,function(run){return run.plot!=_28;});if(ns.length<this.series.length){_3.forEach(this.series,function(run){if(run.plot==_28){run.destroy();}});this.runs={};_3.forEach(ns,function(run,_2c){this.runs[run.plot]=_2c;},this);this.series=ns;}this.dirty=true;}return this;},getPlotOrder:function(){return _f.map(this.stack,_17);},setPlotOrder:function(_2d){var _2e={},_2f=_f.filter(_2d,function(_30){if(!(_30 in this.plots)||(_30 in _2e)){return false;}_2e[_30]=1;return true;},this);if(_2f.length<this.stack.length){_f.forEach(this.stack,function(_31){var _32=_31.name;if(!(_32 in _2e)){_2f.push(_32);}});}var _33=_f.map(_2f,function(_34){return this.stack[this.plots[_34]];},this);_f.forEach(_33,function(_35,i){this.plots[_35.name]=i;},this);this.stack=_33;this.dirty=true;return this;},movePlotToFront:function(_36){if(_36 in this.plots){var _37=this.plots[_36];if(_37){var _38=this.getPlotOrder();_38.splice(_37,1);_38.unshift(_36);return this.setPlotOrder(_38);}}return this;},movePlotToBack:function(_39){if(_39 in this.plots){var _3a=this.plots[_39];if(_3a<this.stack.length-1){var _3b=this.getPlotOrder();_3b.splice(_3a,1);_3b.push(_39);return this.setPlotOrder(_3b);}}return this;},addSeries:function(_3c,_3d,_3e){var run=new _d(this,_3d,_3e);run.name=_3c;if(_3c in this.runs){this.series[this.runs[_3c]].destroy();this.series[this.runs[_3c]]=run;}else{this.runs[_3c]=this.series.length;this.series.push(run);}this.dirty=true;if(!("ymin" in run)&&"min" in run){run.ymin=run.min;}if(!("ymax" in run)&&"max" in run){run.ymax=run.max;}return this;},getSeries:function(_3f){return this.series[this.runs[_3f]];},removeSeries:function(_40){if(_40 in this.runs){var _41=this.runs[_40];delete this.runs[_40];this.series[_41].destroy();this.series.splice(_41,1);_f.forIn(this.runs,function(idx,_42,_43){if(idx>_41){_43[_42]=idx-1;}});this.dirty=true;}return this;},updateSeries:function(_44,_45,_46){if(_44 in this.runs){var run=this.series[this.runs[_44]];run.update(_45);if(_46){this.dirty=true;}else{this._invalidateDependentPlots(run.plot,false);this._invalidateDependentPlots(run.plot,true);}}return this;},getSeriesOrder:function(_47){return _f.map(_f.filter(this.series,function(run){return run.plot==_47;}),_17);},setSeriesOrder:function(_48){var _49,_4a={},_4b=_f.filter(_48,function(_4c){if(!(_4c in this.runs)||(_4c in _4a)){return false;}var run=this.series[this.runs[_4c]];if(_49){if(run.plot!=_49){return false;}}else{_49=run.plot;}_4a[_4c]=1;return true;},this);_f.forEach(this.series,function(run){var _4d=run.name;if(!(_4d in _4a)&&run.plot==_49){_4b.push(_4d);}});var _4e=_f.map(_4b,function(_4f){return this.series[this.runs[_4f]];},this);this.series=_4e.concat(_f.filter(this.series,function(run){return run.plot!=_49;}));_f.forEach(this.series,function(run,i){this.runs[run.name]=i;},this);this.dirty=true;return this;},moveSeriesToFront:function(_50){if(_50 in this.runs){var _51=this.runs[_50],_52=this.getSeriesOrder(this.series[_51].plot);if(_50!=_52[0]){_52.splice(_51,1);_52.unshift(_50);return this.setSeriesOrder(_52);}}return this;},moveSeriesToBack:function(_53){if(_53 in this.runs){var _54=this.runs[_53],_55=this.getSeriesOrder(this.series[_54].plot);if(_53!=_55[_55.length-1]){_55.splice(_54,1);_55.push(_53);return this.setSeriesOrder(_55);}}return this;},resize:function(_56,_57){var box;switch(arguments.length){case 1:box=_2.mixin({},_56);_7.setMarginBox(this.node,box);break;case 2:box={w:_56,h:_57};_7.setMarginBox(this.node,box);break;}box=_7.getMarginBox(this.node);var d=this.surface.getDimensions();if(d.width!=box.w||d.height!=box.h){this.surface.setDimensions(box.w,box.h);this.dirty=true;return this.render();}else{return this;}},getGeometry:function(){var ret={};_f.forIn(this.axes,function(_58){if(_58.initialized()){ret[_58.name]={name:_58.name,vertical:_58.vertical,scaler:_58.scaler,ticks:_58.ticks};}});return ret;},setAxisWindow:function(_59,_5a,_5b,_5c){var _5d=this.axes[_59];if(_5d){_5d.setWindow(_5a,_5b);_3.forEach(this.stack,function(_5e){if(_5e.hAxis==_59||_5e.vAxis==_59){_5e.zoom=_5c;}});}return this;},setWindow:function(sx,sy,dx,dy,_5f){if(!("plotArea" in this)){this.calculateGeometry();}_f.forIn(this.axes,function(_60){var _61,_62,_63=_60.getScaler().bounds,s=_63.span/(_63.upper-_63.lower);if(_60.vertical){_61=sy;_62=dy/s/_61;}else{_61=sx;_62=dx/s/_61;}_60.setWindow(_61,_62);});_3.forEach(this.stack,function(_64){_64.zoom=_5f;});return this;},zoomIn:function(_65,_66,_67){var _68=this.axes[_65];if(_68){var _69,_6a,_6b=_68.getScaler().bounds;var _6c=Math.min(_66[0],_66[1]);var _6d=Math.max(_66[0],_66[1]);_6c=_66[0]<_6b.lower?_6b.lower:_6c;_6d=_66[1]>_6b.upper?_6b.upper:_6d;_69=(_6b.upper-_6b.lower)/(_6d-_6c);_6a=_6c-_6b.lower;this.setAxisWindow(_65,_69,_6a);if(_67){this.delayedRender();}else{this.render();}}},calculateGeometry:function(){if(this.dirty){return this.fullGeometry();}var _6e=_3.filter(this.stack,function(_6f){return _6f.dirty||(_6f.hAxis&&this.axes[_6f.hAxis].dirty)||(_6f.vAxis&&this.axes[_6f.vAxis].dirty);},this);_70(_6e,this.plotArea);return this;},fullGeometry:function(){this._makeDirty();_3.forEach(this.stack,_12);if(!this.theme){this.setTheme(new _c());}_3.forEach(this.series,function(run){if(!(run.plot in this.plots)){if(!dc.plot2d||!dc.plot2d.Default){throw Error("Can't find plot: Default - didn't you forget to dojo"+".require() it?");}var _71=new dc.plot2d.Default(this,{});_71.name=run.plot;this.plots[run.plot]=this.stack.length;this.stack.push(_71);}this.stack[this.plots[run.plot]].addSeries(run);},this);_3.forEach(this.stack,function(_72){if(_72.assignAxes){_72.assignAxes(this.axes);}},this);var dim=this.dim=this.surface.getDimensions();dim.width=g.normalizedLength(dim.width);dim.height=g.normalizedLength(dim.height);_f.forIn(this.axes,_12);_70(this.stack,dim);var _73=this.offsets={l:0,r:0,t:0,b:0};_f.forIn(this.axes,function(_74){_f.forIn(_74.getOffsets(),function(o,i){_73[i]=Math.max(o,_73[i]);});});if(this.title){this.titleGap=(this.titleGap==0)?0:this.titleGap||this.theme.chart.titleGap||20;this.titlePos=this.titlePos||this.theme.chart.titlePos||"top";this.titleFont=this.titleFont||this.theme.chart.titleFont;this.titleFontColor=this.titleFontColor||this.theme.chart.titleFontColor||"black";var _75=g.normalizedLength(g.splitFontString(this.titleFont).size);_73[this.titlePos=="top"?"t":"b"]+=(_75+this.titleGap);}_f.forIn(this.margins,function(o,i){_73[i]+=o;});this.plotArea={width:dim.width-_73.l-_73.r,height:dim.height-_73.t-_73.b};_f.forIn(this.axes,_12);_70(this.stack,this.plotArea);return this;},render:function(){if(this._delayedRenderHandle){clearTimeout(this._delayedRenderHandle);this._delayedRenderHandle=null;}if(this.theme){this.theme.clear();}if(this.dirty){return this.fullRender();}this.calculateGeometry();_f.forEachRev(this.stack,function(_76){_76.render(this.dim,this.offsets);},this);_f.forIn(this.axes,function(_77){_77.render(this.dim,this.offsets);},this);this._makeClean();return this;},fullRender:function(){this.fullGeometry();var _78=this.offsets,dim=this.dim;var w=Math.max(0,dim.width-_78.l-_78.r),h=Math.max(0,dim.height-_78.t-_78.b);_3.forEach(this.series,_13);_f.forIn(this.axes,_13);_3.forEach(this.stack,_13);if(this.chartTitle&&this.chartTitle.tagName){_8.destroy(this.chartTitle);}if(this.plotGroup){this.plotGroup.clear();}this.surface.clear();this.chartTitle=null;if(this.plotGroup){this._renderChartBackground(dim,_78);this._renderPlotBackground(dim,_78,w,h);this.surface.add(this.plotGroup);this.plotGroup.setClip({x:_78.l,y:_78.t,width:w,height:h});}else{this._renderPlotBackground(dim,_78,w,h);}_f.foldr(this.stack,function(z,_79){return _79.render(dim,_78),0;},0);if(!this.plotGroup){this._renderChartBackground(dim,_78);}if(this.title){var _7a=(g.renderer=="canvas"),_7b=_7a||!_a("ie")&&!_a("opera")?"html":"gfx",_7c=g.normalizedLength(g.splitFontString(this.titleFont).size);this.chartTitle=_e.createText[_7b](this,this.surface,dim.width/2,this.titlePos=="top"?_7c+this.margins.t:dim.height-this.margins.b,"middle",this.title,this.titleFont,this.titleFontColor);}_f.forIn(this.axes,function(_7d){_7d.render(dim,_78);});this._makeClean();return this;},_renderChartBackground:function(dim,_7e){var t=this.theme,_7f;var _80=this.fill!==undefined?this.fill:(t.chart&&t.chart.fill);var _81=this.stroke!==undefined?this.stroke:(t.chart&&t.chart.stroke);if(_80=="inherit"){var _82=this.node;_80=new _9(_5.get(_82,"backgroundColor"));while(_80.a==0&&_82!=document.documentElement){_80=new _9(_5.get(_82,"backgroundColor"));_82=_82.parentNode;}}if(_80){if(this.plotGroup){_80=_b.prototype._shapeFill(_b.prototype._plotFill(_80,dim),{x:0,y:0,width:dim.width+1,height:dim.height+1});this.surface.createRect({width:dim.width+1,height:dim.height+1}).setFill(_80);}else{_80=_b.prototype._plotFill(_80,dim,_7e);if(_7e.l){_7f={x:0,y:0,width:_7e.l,height:dim.height+1};this.surface.createRect(_7f).setFill(_b.prototype._shapeFill(_80,_7f));}if(_7e.r){_7f={x:dim.width-_7e.r,y:0,width:_7e.r+1,height:dim.height+2};this.surface.createRect(_7f).setFill(_b.prototype._shapeFill(_80,_7f));}if(_7e.t){_7f={x:0,y:0,width:dim.width+1,height:_7e.t};this.surface.createRect(_7f).setFill(_b.prototype._shapeFill(_80,_7f));}if(_7e.b){_7f={x:0,y:dim.height-_7e.b,width:dim.width+1,height:_7e.b+2};this.surface.createRect(_7f).setFill(_b.prototype._shapeFill(_80,_7f));}}}if(_81){this.surface.createRect({width:dim.width-1,height:dim.height-1}).setStroke(_81);}},_renderPlotBackground:function(dim,_83,w,h){var t=this.theme;var _84=t.plotarea&&t.plotarea.fill;var _85=t.plotarea&&t.plotarea.stroke;var _86={x:_83.l-1,y:_83.t-1,width:w+2,height:h+2};if(_84){_84=_b.prototype._shapeFill(_b.prototype._plotFill(_84,dim,_83),_86);this.surface.createRect(_86).setFill(_84);}if(_85){this.surface.createRect({x:_83.l,y:_83.t,width:w+1,height:h+1}).setStroke(_85);}},delayedRender:function(){if(!this._delayedRenderHandle){this._delayedRenderHandle=setTimeout(_2.hitch(this,function(){this.render();}),this.delayInMs);}return this;},connectToPlot:function(_87,_88,_89){return _87 in this.plots?this.stack[this.plots[_87]].connect(_88,_89):null;},fireEvent:function(_8a,_8b,_8c){if(_8a in this.runs){var _8d=this.series[this.runs[_8a]].plot;if(_8d in this.plots){var _8e=this.stack[this.plots[_8d]];if(_8e){_8e.fireEvent(_8a,_8b,_8c);}}}return this;},_makeClean:function(){_3.forEach(this.axes,_15);_3.forEach(this.stack,_15);_3.forEach(this.series,_15);this.dirty=false;},_makeDirty:function(){_3.forEach(this.axes,_16);_3.forEach(this.stack,_16);_3.forEach(this.series,_16);this.dirty=true;},_invalidateDependentPlots:function(_8f,_90){if(_8f in this.plots){var _91=this.stack[this.plots[_8f]],_92,_93=_90?"vAxis":"hAxis";if(_91[_93]){_92=this.axes[_91[_93]];if(_92&&_92.dependOnData()){_92.dirty=true;_3.forEach(this.stack,function(p){if(p[_93]&&p[_93]==_91[_93]){p.dirty=true;}});}}else{_91.dirty=true;}}}});function _94(_95){return {min:_95.hmin,max:_95.hmax};};function _96(_97){return {min:_97.vmin,max:_97.vmax};};function _98(_99,h){_99.hmin=h.min;_99.hmax=h.max;};function _9a(_9b,v){_9b.vmin=v.min;_9b.vmax=v.max;};function _9c(_9d,_9e){if(_9d&&_9e){_9d.min=Math.min(_9d.min,_9e.min);_9d.max=Math.max(_9d.max,_9e.max);}return _9d||_9e;};function _70(_9f,_a0){var _a1={},_a2={};_3.forEach(_9f,function(_a3){var _a4=_a1[_a3.name]=_a3.getSeriesStats();if(_a3.hAxis){_a2[_a3.hAxis]=_9c(_a2[_a3.hAxis],_94(_a4));}if(_a3.vAxis){_a2[_a3.vAxis]=_9c(_a2[_a3.vAxis],_96(_a4));}});_3.forEach(_9f,function(_a5){var _a6=_a1[_a5.name];if(_a5.hAxis){_98(_a6,_a2[_a5.hAxis]);}if(_a5.vAxis){_9a(_a6,_a2[_a5.vAxis]);}_a5.initializeScalers(_a0,_a6);});};return _1.charting.Chart;});